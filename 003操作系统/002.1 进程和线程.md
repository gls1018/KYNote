**1. 进程概念**





**2. 进程的组成**

- PCB
  - 进程描述信息
  - 进程控制和管理信息，进程当前状态， 进程优先级
  - 资源分配清单，内存地址空间或虚拟地址空间的状况，打开的文件列表和所使用的输入、输出设备信息
  - 处理机相关信息，也叫CPU上下文，主要指CPU各个寄存器中的值
- 程序段
- 数据段





**3. 进程的状态与转换**

- 运行态:
  - 进程正在CPU上运行，单CPU中，每个时刻只有一个进程处于运行状态
- 就绪态
  - 进程获得了除CPU以外的一切所需资源。一旦得到CPU就可以立刻运行
- 阻塞态
  - 等待某个事件比如I/O, 系统根据阻塞原因不同，设置多个阻塞队列
- 创建态
  - 进程正在被创建，尚未转到就绪态
    - 首先申请一个空白PCB,并向PCB中写入进程控制信息
    - 为进程分配运行时必须的资源，**然后插入就绪队列**
    - 如果资源分配需求得不到满足，比如内存不足，则创建工作未完成，进程此时所处的状态为创建态
- 终止态
  - 进程正在系统中消失，可能是进程正常结束，亦或者是其他原因退出运行，系统首先将进程设置为终止态，然后进一步处理资源释放和回收工作。











**4. 进程控制**



- 进程的创建的时机
  - 终端用户登录
  - 作业调度
  - 系统提供服务
  - 用户程序的应用请求
  - 。。。。等等
- 进程的终止
- 进程的阻塞和唤醒



系统创建一个新进程的过程如下：**创建原语**

1. 为新进程分配一个唯一的进程PID, 并申请一个空白的PCB, PCB是有限的，若PCB申请失败，则创建失败

2. 为进程分配其运行所需的资源，如内存、文件、IO设备和CPU时间。若资源不足，**不是创建失败，而是处于创建态，等待资源**
3. 初始化PCB,主要包括初始化标志信息、初始化CPU状态信息和控制信息。设置进程优先级
4. 就绪队列中还有空间的话，将进程放入就绪队列



系统终止进程的过程如下： **终止原语**

1. 根据PID检索到PCB, 从中读取出进程的状态
2. 若被终止进程处于运行状态，立即终止进程运行，将CPU资源分配给其他进程
3. 若该进程还有其他子孙进程，则通常需要将其所有子孙进程终止
4. 将该进程的所有资源归还给父进程或者操作系统
5. 将PCB从所在的队列中删除





**进程阻塞事件**：

正在执行的进程，由于期待的某些事件没有发生，如请求系统资源失败、等待某种操作的完成、新数据尚未到达或者无新任务可做等，进程通过调用阻塞原语，使自己由运行态编程阻塞态。

**阻塞原语:**

1. 根据PID找到进程的PCB
2. 若该进程处于运行态，则保护现场，将其状态转化为阻塞态，停止运行
3. 将PCB插入到相应事件的等待队列，将CPU资源调度给其他就绪进程





**进程唤醒事件：**

当被阻塞进程所期待的事件出现时，如IO操作已完成或者期待的数据已到达，由有关进程调用唤醒原语，将该进程唤醒。

**唤醒原语:**

1. 在该事件的等待队列中找到相应进程的PCB
2. 将其从就绪队列中移出，并设置状态为就绪态
3. 将该PCB插入就绪队列，等待调度程序调度











**5. 进程的通信**



- 共享存储
- 消息传递
- 管道通信
- 信号





**6. 线程的组成**

- 





### 线程的实现方式

线程的实现分为两类:

- 用户级线程(User-Level Thread    ULT)
- 内核级线程(Kernel-Level Thread  KLT), 也叫内核支持的线程



#### 用户级线程

用户级线程就是从用户视角能看到的线程，线程的创建、撤销和切换的工作都是在应用程序空间里面完成的。无需操作系统干预



对于用户级线程，**其调度仍然以进程为单位进行,各个进程轮流执行一个时间片,**假设进程A有一个用户级线程，进程B有100个用户级线程，那么进程A中的线程的运行时间是进程B中线程运行时间的100倍，对于线程来说，是不公平的.



用户级线程优点:

- 线程切换不需要转到内核空间，节省了模式切换的开销
- 调度算法可以是进程专用的，不同进程可以根据需要，对自己的线程选择不同的调度算法
- 用户级线程和操作系统平台无关，对线程管理的代码是用户程序的一部分



缺点如下:

- 系统调用阻塞问题，一个线程阻塞了，其它线程全部阻塞
- 不能发挥多CPU优势，内核每次分配给进程的只有一个CPU, 因此进程中只有一个线程能执行



#### 内核级线程

对线程的管理全部在内核空间（内核态）中完成，操作系统为每个内核级别线程设置一个线程控制块TCB, 内核根据TCB感知线程的存在。



优点:

- 可以发挥多CPU优势，内核可以同时调度一个进程中的多个线程同时运行
- 进程中一个线程被阻塞，内核可以调度其他线程来占用CPU
- 内核支持线程具有很小的数据结构和堆栈，线程切换比较快
- 内核本身可以采用多线程技术，提高系统的执行速度和效率



缺点: 

- 同一进程中的线程切换，需要从用户态转到内核态进行，系统开销大





#### 组合方式



